{% extends "base.html" %}

{% block title %}Kết quả tìm kiếm{% endblock %}

{% block head %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* --- CSS RIÊNG CỦA TRANG KẾT QUẢ --- */
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-attachment: fixed;
        }
        
        .overlay {
            background: rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: -1;
        }

        .container {
            position: relative;
            z-index: 2;
            margin-top: 60px; /* Điều chỉnh lại chút cho thoáng */
            padding-bottom: 100px; /* Chừa chỗ cho thanh so sánh */
        }

        /* Header Section Mới */
        .header-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .hotel-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            margin-bottom: 30px;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .hotel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .hotel-image {
            height: 200px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        
        /* Badge rating trên ảnh */
        .rating-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: #ffc107;
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .hotel-info {
            padding: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative
        }

        .hotel-name {
            font-size: 1.25rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            /* Cắt chữ nếu tên quá dài */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .price {
            font-size: 1.3rem;
            font-weight: bold;
            color: #28a745;
        }

        .amenities {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-bottom: 15px;
        }

        .amenity-tag {
            background: #f1f3f5;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            color: #555;
            border: 1px solid #e9ecef;
        }

        .btn-view {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 0;
            border-radius: 25px;
            text-decoration: none;
            display: block;
            width: 100%;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-view:hover {
            background: #0056b3;
            color: white;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
        }

        /* --- CSS CHO THANH SO SÁNH (FLOATING BAR) --- */
        .preview-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 140px;
            text-align: center;
        }

        .preview-img {
            width: 80px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 4px;
            background-color: #f0f0f0;
        }

        .preview-name {
            font-size: 0.75rem;
            line-height: 1.2;
            white-space: nowrap; 
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            color: #333;
        }

        .preview-separator {
            width: 1px;
            height: 40px;
            background-color: #ccc;
            margin: 0 20px;
        }

        /* CSS cho Checkbox */
        .compare-checkbox { cursor: pointer; border-color: #007bff; width: 1.2em; height: 1.2em; }
        .compare-checkbox:checked { background-color: #007bff; border-color: #007bff; }

        /* CSS cho Bảng so sánh */
        .cmp-img { width: 100%; height: 150px; object-fit: cover; border-radius: 8px; }
        .cmp-price { font-size: 1.2rem; color: #dc3545; font-weight: bold; }
        .cmp-score { background: #003580; color: white; padding: 5px 10px; border-radius: 5px 5px 5px 0; font-weight: bold; }
        .bg-light-gray { background-color: #f8f9fa; font-weight: 600; width: 20%; text-align: left; }
        .btn-favorite {
            background: white;        /* Nền trắng để nổi bật */
            border: 1px solid #ddd;   /* Viền nhẹ */
            border-radius: 50%;       /* Bo tròn thành hình tròn */
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Đổ bóng nhẹ */
        }

        /* Hiệu ứng khi di chuột vào */
        .btn-favorite:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-color: #dc3545;
        }

        /* Icon trái tim */
        .btn-favorite i {
            font-size: 1.2rem;
            color: #dc3545; /* Màu đỏ */
            transition: transform 0.2s;
        }

        .btn-favorite:active i {
            transform: scale(0.9);
        }
    </style>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container">
        
        <div class="header-section">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center">
                <div class="mb-3 mb-md-0">
                    <h4 class="fw-bold mb-1">
                        <i class="fas fa-search-location text-primary me-2"></i>
                        Kết quả cho: <span class="text-primary">{{ search_params.city if search_params.city else '...' }}</span>
                    </h4>
                    <div class="text-muted small">
                        {% if search_params.price_range %}Khoảng giá: {{ search_params.price_range }} •{% endif %}
                        {% if search_params.rating_range %}{{ search_params.rating_range }} sao •{% endif %}
                        {% if search_params.amenity %}Tiện nghi: {{ search_params.amenity }}{% endif %}
                        {% if not search_params.price_range and not search_params.rating_range and not search_params.amenity %}
                            (Hiển thị tất cả kết quả)
                        {% endif %}
                    </div>
                </div>

                <div class="d-flex align-items-center gap-3">
                    <div class="d-flex align-items-center">
                        <label for="sortSelect" class="me-2 fw-bold text-nowrap text-secondary">Sắp xếp:</label>
                        <select id="sortSelect" class="form-select shadow-none border-secondary" style="width: 200px;" onchange="sortHotels()">
                            <option value="price_asc">Giá: Thấp đến Cao</option>
                            <option value="price_desc">Giá: Cao đến Thấp</option>
                            <option value="rating_desc">Điểm đánh giá cao nhất</option>
                            <option value="reviews_desc">Nhiều review nhất</option>
                        </select>
                    </div>
                    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-sm" title="Tìm kiếm lại">
                        <i class="fas fa-redo"></i>
                    </a>
                </div>
            </div>
        </div>

        {% if error %}
        <div class="no-results">
            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
            <h3>Không tìm thấy kết quả</h3>
            <p class="text-muted">{{ error }}</p>
            <a href="{{ url_for('home') }}" class="btn btn-primary">Thử lại</a>
        </div>
        
        {% elif hotels %}
        <div class="row" id="hotelGrid">
            {% for hotel in hotels %}
            <div class="col-lg-4 col-md-6 mb-4 hotel-item"
                 data-price="{{ hotel.rate_per_night.extracted_lowest if hotel.rate_per_night and hotel.rate_per_night.extracted_lowest else 99999999 }}" 
                 data-rating="{{ hotel.overall_rating if hotel.overall_rating else 0 }}"
                 data-reviews="{{ hotel.reviews if hotel.reviews else 0 }}">
                 
                <div class="hotel-card h-100">
                    <div class="hotel-image" style="background-image: url('{{ hotel.images[0].original_image if hotel.images else 'https://via.placeholder.com/400x300' }}')">
                        <div class="rating-badge">
                            {{ hotel.overall_rating if hotel.overall_rating else 'N/A' }} <i class="fas fa-star"></i>
                        </div>
                    </div>
                    
                    <div class="hotel-info">
                        <h5 class="hotel-name" title="{{ hotel.name }}">{{ hotel.name }}</h5>
                        
                        <div class="mb-2 text-warning small">
                            {% set stars = hotel.extracted_hotel_class if hotel.extracted_hotel_class else 0 %}
                            {% for i in range(stars) %}<i class="fas fa-star"></i>{% endfor %}
                        </div>
                        
                        <div class="amenities">
                            {% if hotel.amenities %}
                                {% for amenity in hotel.amenities[:3] %}
                                <span class="amenity-tag">{{ amenity.name if amenity.name else amenity }}</span>
                                {% endfor %}
                            {% endif %}
                        </div>

                        <div class="mt-auto pt-3 border-top">
                            <div class="d-flex justify-content-between align-items-end mb-3">
                                <div>
                                    <small class="text-muted d-block" style="font-size: 0.8rem;">Giá mỗi đêm</small>
                                    <span class="price">
                                        {{ hotel.rate_per_night.lowest if hotel.rate_per_night else 'Liên hệ' }}
                                    </span>
                                </div>

                                <button class="btn-favorite" onclick="addToFavorites(this)" 
                                        data-hotel-info='{{ hotel | tojson | safe }}'
                                        title="Thêm vào yêu thích">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>

                            <div class="form-check mb-2 bg-light p-2 rounded border">
                                <input class="form-check-input compare-checkbox" type="checkbox" 
                                    id="compare-{{ loop.index }}" 
                                    value="{{ hotel.property_token }}"
                                    onchange="handleCompare(this)"
                                    data-hotel='{{ hotel | tojson | safe }}'> 
                                <label class="form-check-label small user-select-none w-100 fw-bold text-secondary" style="cursor: pointer;" for="compare-{{ loop.index }}">
                                    So sánh khách sạn này
                                </label>
                            </div>

                            <a href="{{ url_for('hotel_detail', property_token=hotel.property_token) }}" class="btn btn-view rounded-pill">
                                Xem chi tiết <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        {% else %}
        <div class="no-results">
            <i class="fas fa-search fa-3x text-muted mb-3"></i>
            <h3>Không tìm thấy khách sạn</h3>
            <p class="text-muted">Vui lòng thử thay đổi tiêu chí tìm kiếm</p>
            <a href="{{ url_for('home') }}" class="btn btn-primary">Tìm kiếm lại</a>
        </div>
        {% endif %}
    </div>

    <div id="compareBar" class="fixed-bottom bg-white border-top shadow-lg py-2" style="display: none; z-index: 1050;">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                
                <div class="d-flex align-items-center" style="min-width: 200px;">
                    <div class="text-primary fs-4 me-2"><i class="fas fa-balance-scale"></i></div>
                    <div>
                        <div class="fw-bold text-primary">So sánh</div>
                        <small class="text-muted" id="compareCount">0/2 đã chọn</small>
                    </div>
                </div>

                <div id="comparePreviewArea" class="d-flex align-items-center justify-content-center flex-grow-1 mx-3 position-relative">
                    </div>

                <div class="d-flex gap-2" style="min-width: 200px; justify-content: flex-end;">
                    <button class="btn btn-outline-secondary btn-sm" onclick="clearCompare()">Hủy chọn</button>
                    <button class="btn btn-primary btn-sm px-3 fw-bold" onclick="showCompareModal()">Xem so sánh</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="compareModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered"> 
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold"><i class="fas fa-exchange-alt text-primary"></i> So sánh chi tiết</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered text-center align-middle mb-0" id="compareTable">
                            </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. SORTING LOGIC ---
        function sortHotels() {
            const sortBy = document.getElementById('sortSelect').value;
            const grid = document.getElementById('hotelGrid');
            if(!grid) return;
            
            const items = Array.from(grid.getElementsByClassName('hotel-item'));

            items.sort((a, b) => {
                const priceA = parseFloat(a.getAttribute('data-price'));
                const priceB = parseFloat(b.getAttribute('data-price'));
                const ratingA = parseFloat(a.getAttribute('data-rating'));
                const ratingB = parseFloat(b.getAttribute('data-rating'));
                const reviewA = parseFloat(a.getAttribute('data-reviews'));
                const reviewB = parseFloat(b.getAttribute('data-reviews'));

                switch(sortBy) {
                    case 'price_asc': return priceA - priceB;
                    case 'price_desc': return priceB - priceA;
                    case 'rating_desc': return ratingB - ratingA;
                    case 'reviews_desc': return reviewB - reviewA;
                    default: return 0;
                }
            });
            items.forEach(item => grid.appendChild(item));
        }

        // --- 2. COMPARE LOGIC ---
        let compareList = [];

        function handleCompare(checkbox) {
            const hotelData = JSON.parse(checkbox.getAttribute('data-hotel'));

            if (checkbox.checked) {
                if (compareList.length >= 2) {
                    alert("Bạn chỉ có thể so sánh tối đa 2 khách sạn!");
                    checkbox.checked = false;
                    return;
                }
                compareList.push(hotelData);
            } else {
                compareList = compareList.filter(h => h.property_token !== hotelData.property_token);
            }
            updateCompareBar();
        }

        function updateCompareBar() {
            const bar = document.getElementById('compareBar');
            const countSpan = document.getElementById('compareCount');
            const previewArea = document.getElementById('comparePreviewArea');
            
            countSpan.innerText = `${compareList.length}/2 đã chọn`;
            
            let htmlContent = '';
            compareList.forEach((hotel, index) => {
                let imgSrc = (hotel.images && hotel.images.length > 0) ? hotel.images[0].original_image : 'https://via.placeholder.com/80x50?text=No+Img';
                htmlContent += `
                    <div class="preview-item">
                        <img src="${imgSrc}" class="preview-img" alt="Hotel Img">
                        <div class="preview-name" title="${hotel.name}">${hotel.name}</div>
                    </div>
                `;
                if (index === 0 && compareList.length > 1) {
                    htmlContent += `<div class="preview-separator"></div>`;
                }
            });
            previewArea.innerHTML = htmlContent;

            if (compareList.length > 0) {
                bar.style.display = 'block';
            } else {
                bar.style.display = 'none';
            }
        }

        function clearCompare() {
            compareList = [];
            document.querySelectorAll('.compare-checkbox').forEach(cb => cb.checked = false);
            updateCompareBar();
        }

        function showCompareModal() {
            if (compareList.length < 2) {
                alert("Vui lòng chọn đủ 2 khách sạn.");
                return;
            }
            const table = document.getElementById('compareTable');
            const h1 = compareList[0];
            const h2 = compareList[1];
            
            const renderCheck = (condition) => condition ? '<i class="fas fa-check text-success"></i>' : '<i class="fas fa-times text-muted opacity-25"></i>';
            const hasAmenity = (hotel, key) => {
                if (!hotel.amenities) return false;
                return hotel.amenities.some(a => (typeof a === 'string' ? a : a.name).toLowerCase().includes(key.toLowerCase()));
            };

            table.innerHTML = `
                <thead>
                    <tr>
                        <th class="bg-light-gray">Tiêu chí</th>
                        <th style="width: 40%">${h1.name}</th>
                        <th style="width: 40%">${h2.name}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Hình ảnh</td>
                        <td><img src="${h1.images[0].original_image}" class="cmp-img"></td>
                        <td><img src="${h2.images[0].original_image}" class="cmp-img"></td>
                    </tr>
                    <tr>
                        <td>Giá / đêm</td>
                        <td class="cmp-price">${h1.rate_per_night.lowest}</td>
                        <td class="cmp-price">${h2.rate_per_night.lowest}</td>
                    </tr>
                    <tr>
                        <td>Đánh giá</td>
                        <td><span class="cmp-score">${h1.overall_rating}/5</span> <br> <small class="text-muted">${h1.reviews} reviews</small></td>
                        <td><span class="cmp-score">${h2.overall_rating}/5</span> <br> <small class="text-muted">${h2.reviews} reviews</small></td>
                    </tr>
                    <tr>
                        <td>Hạng sao</td>
                        <td class="text-warning">${'★'.repeat(h1.extracted_hotel_class || 0)}</td>
                        <td class="text-warning">${'★'.repeat(h2.extracted_hotel_class || 0)}</td>
                    </tr>
                    <tr>
                        <td class="fw-bold bg-light">Tiện nghi</td><td colspan="2"></td>
                    </tr>
                    <tr><td>Bể bơi</td><td>${renderCheck(hasAmenity(h1, 'Pool'))}</td><td>${renderCheck(hasAmenity(h2, 'Pool'))}</td></tr>
                    <tr><td>Ăn sáng</td><td>${renderCheck(hasAmenity(h1, 'Breakfast'))}</td><td>${renderCheck(hasAmenity(h2, 'Breakfast'))}</td></tr>
                    <tr><td>Wifi Free</td><td>${renderCheck(hasAmenity(h1, 'Wi-Fi'))}</td><td>${renderCheck(hasAmenity(h2, 'Wi-Fi'))}</td></tr>
                    <tr>
                        <td></td>
                        <td><a href="/hotel/${h1.property_token}" class="btn btn-primary w-100">Chi tiết</a></td>
                        <td><a href="/hotel/${h2.property_token}" class="btn btn-primary w-100">Chi tiết</a></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" class="p-3 bg-light">
                            <div id="aiAnalysisArea" class="text-start">
                                <button class="btn btn-outline-primary w-100 fw-bold" onclick="runAiCompare()">
                                    <i class="fas fa-magic me-2"></i> Nhờ AI phân tích ưu nhược điểm
                                </button>
                            </div>
                        </td>
                    </tr>
                </tfoot>
            `;
            new bootstrap.Modal(document.getElementById('compareModal')).show();
        }

        // --- 3. AI ANALYSIS LOGIC ---
        async function runAiCompare() {
            const area = document.getElementById('aiAnalysisArea');
            area.innerHTML = `
                <div class="d-flex align-items-center text-primary justify-content-center py-3">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    <span>Đang đọc thông tin và so sánh...</span>
                </div>
            `;

            try {
                const resp = await fetch('/api/compare_ai', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ hotels: compareList })
                });
                const data = await resp.json();

                if (data.reply) {
                    area.innerHTML = `
                        <div class="alert alert-primary border-0 shadow-sm mb-0">
                            <h6 class="fw-bold mb-2"><i class="fas fa-robot"></i> Góc nhìn của AI:</h6>
                            <div class="small" style="line-height: 1.6;">
                                ${marked.parse(data.reply)}
                            </div>
                        </div>
                    `;
                } else {
                    area.innerHTML = `<span class="text-danger">AI đang bận, thử lại sau nhé.</span>`;
                }
            } catch (e) {
                console.error(e);
                area.innerHTML = `<span class="text-danger">Lỗi kết nối.</span>`;
            }
        }

        // Tự động sắp xếp khi load trang
        document.addEventListener('DOMContentLoaded', () => {
            sortHotels();
        });
        
        async function addToFavorites(buttonElement) {
        // 1. Ngăn chặn sự kiện click lan ra ngoài (ví dụ nếu thẻ card có link)
            event.preventDefault(); 
            event.stopPropagation();

            // 2. Kiểm tra xem người dùng đã đăng nhập chưa (dựa vào biến user từ base.html truyền xuống)
            // Lưu ý: Cách này chỉ kiểm tra phía client. Backend vẫn cần kiểm tra bảo mật.
            {% if not user %}
                alert("Vui lòng đăng nhập để lưu khách sạn yêu thích!");
                // Có thể chuyển hướng sang trang login nếu muốn:
                // window.location.href = "{{ url_for('login') }}"; 
                return;
            {% endif %}

            const icon = buttonElement.querySelector('i');

            // Nếu icon đã là 'fas' (solid - đặc) thì có nghĩa là đã thích rồi -> không làm gì hoặc xử lý xóa
            // Ở đây tạm thời chỉ xử lý logic ADD như yêu cầu.
            if (icon.classList.contains('fas')) {
                alert("Khách sạn này đã có trong danh sách yêu thích của bạn.");
                return;
            }

            // 3. Lấy dữ liệu khách sạn từ thuộc tính data-hotel-info
            const hotelDataRaw = JSON.parse(buttonElement.getAttribute('data-hotel-info'));

            // 4. Chuẩn bị dữ liệu (payload) đúng theo cấu trúc backend endpoint '/favorites' yêu cầu
            // Backend cần: property_token, name, image, price, address
            const payload = {
                property_token: hotelDataRaw.property_token,
                name: hotelDataRaw.name,
                // Lấy ảnh đầu tiên hoặc chuỗi rỗng nếu không có
                image: (hotelDataRaw.images && hotelDataRaw.images.length > 0) ? hotelDataRaw.images[0].original_image : '',
                // Lấy giá thấp nhất hoặc N/A
                price: (hotelDataRaw.rate_per_night && hotelDataRaw.rate_per_night.lowest) ? hotelDataRaw.rate_per_night.lowest : 'N/A',
                address: hotelDataRaw.address || 'Đang cập nhật'
            };

            // Hiển thị trạng thái đang xử lý (optional: đổi icon thành spinner)
            buttonElement.disabled = true;
            buttonElement.style.opacity = "0.7";

            try {
                // 5. Gửi POST request lên backend
                const response = await fetch('/favorites', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        // Nếu backend của bạn cần CSRF token thì thêm vào đây
                    },
                    body: JSON.stringify(payload)
                });

                // 6. Xử lý phản hồi
                if (response.ok) {
                    // Thành công: Đổi icon trái tim rỗng (far) thành đặc (fas)
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    // Hiệu ứng nhỏ để báo thành công
                    icon.style.transform = 'scale(1.3)';
                    setTimeout(() => icon.style.transform = 'scale(1)', 300);
                    
                    // Có thể thay alert bằng Toast notification cho đẹp
                    // alert("Đã thêm vào yêu thích thành công!");
                } else if (response.status === 401 || response.redirected) {
                    // Trường hợp chưa đăng nhập mà backend trả về 401 hoặc redirect
                    alert("Phiên đăng nhập hết hạn. Vui lòng đăng nhập lại.");
                    window.location.href = "{{ url_for('login') }}";
                } else {
                    // Xử lý lỗi khác từ backend
                    const errorData = await response.json();
                    alert(`Lỗi: ${errorData.message || "Không thể thêm vào yêu thích."}`);
                }
            } catch (error) {
                console.error('Lỗi khi gọi API favorites:', error);
                alert("Đã có lỗi xảy ra. Vui lòng thử lại sau.");
            } finally {
                // Bật lại nút
                buttonElement.disabled = false;
                buttonElement.style.opacity = "1";
            }
        }
    </script>
{% endblock %}